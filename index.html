<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <title>VR Whack-a-Mole Game</title>
</head>
<body>
    <a-scene background="color: #87CEEB">
        <!-- Ground -->
        <a-plane position="0 0 -4" 
                 rotation="-90 0 0" 
                 width="10" 
                 height="10" 
                 color="green">
        </a-plane>

        <!-- Holes in the ground -->
        <a-cylinder position="-2 0.01 -3" 
                    radius="0.6" 
                    height="0.02" 
                    color="black">
        </a-cylinder>
        
        <a-cylinder position="0 0.01 -3" 
                    radius="0.6" 
                    height="0.02" 
                    color="black">
        </a-cylinder>
        
        <a-cylinder position="2 0.01 -3" 
                    radius="0.6" 
                    height="0.02" 
                    color="black">
        </a-cylinder>

        <!-- Moles (start hidden underground) -->
        <a-box id="mole1" 
               position="-2 -1 -3" 
               width="0.8" 
               height="0.8" 
               depth="0.8"
               material="color: brown"
               class="mole">
        </a-box>
        
        <a-sphere id="mole2" 
                  position="0 -1 -3" 
                  radius="0.4"
                  material="color: gray"
                  class="mole">
        </a-sphere>
        
        <a-box id="mole3" 
               position="2 -1 -3" 
               width="0.8" 
               height="0.8" 
               depth="0.8"
               material="color: brown"
               class="mole">
        </a-box>

        <!-- Score display -->
        <a-text id="score" 
                value="Score: 0" 
                position="-1 3 -4" 
                color="white" 
                scale="2 2 2"
                visible="false">
        </a-text>

        <!-- Instructions Screen -->
        <a-entity id="instructionsScreen">
            <!-- Title - moved up and made smaller -->
            <a-text value="VR WHACK-A-MOLE" 
                    position="0 3.5 -4" 
                    color="yellow" 
                    scale="2.5 2.5 2.5"
                    align="center">
            </a-text>
            
            <!-- Instructions - moved up and made smaller -->
            <a-text value="HOW TO PLAY:" 
                    position="0 2.8 -4" 
                    color="white" 
                    scale="1.2 1.2 1.2"
                    align="center">
            </a-text>
            
            <a-text value="• Moles will pop up from holes" 
                    position="0 2.4 -4" 
                    color="white" 
                    scale="1 1 1"
                    align="center">
            </a-text>
            
            <a-text value="• Look at a mole and CLICK to hit it" 
                    position="0 2.1 -4" 
                    color="white" 
                    scale="1 1 1"
                    align="center">
            </a-text>
            
            <a-text value="• Hit moles quickly before they hide!" 
                    position="0 1.8 -4" 
                    color="white" 
                    scale="1 1 1"
                    align="center">
            </a-text>
            
            <a-text value="• Each hit = 10 points" 
                    position="0 1.5 -4" 
                    color="white" 
                    scale="1 1 1"
                    align="center">
            </a-text>
            
            <!-- Start button - now has more space below instructions -->
            <a-sphere id="startButton"
                      position="0 0.8 -2.5" 
                      radius="0.25"
                      color="green"
                      class="clickable">
            </a-sphere>
            
            <a-text value="CLICK GREEN BALL TO START" 
                    position="0 0.4 -4" 
                    color="yellow" 
                    scale="1.5 1.5 1.5"
                    align="center">
            </a-text>
            
            <!-- Countdown display (hidden initially) -->
            <a-text id="countdown" 
                    value="3" 
                    position="0 2 -4" 
                    color="red" 
                    scale="5 5 5"
                    align="center"
                    visible="false">
            </a-text>
        </a-entity>

        <!-- Camera with cursor -->
        <a-camera position="0 1.6 0">
            <a-cursor color="white" 
                     raycaster="objects: .mole, .clickable"
                     geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03">
            </a-cursor>
        </a-camera>
    </a-scene>

    <script>
        let score = 0;
        let gameActive = false;
        let gameStarted = false;
        const moles = document.querySelectorAll('.mole');
        const scoreDisplay = document.getElementById('score');
        const instructionsScreen = document.getElementById('instructionsScreen');
        const startButton = document.getElementById('startButton');
        const countdown = document.getElementById('countdown');
        let activeMoles = new Set();

        // Function to show a mole
        function showMole(mole) {
            if (activeMoles.has(mole)) return;
            
            activeMoles.add(mole);
            
            // Get current position
            const currentPos = mole.getAttribute('position');
            const upPosition = `${currentPos.x} 0.5 ${currentPos.z}`;
            
            // Move mole up using direct position change
            mole.setAttribute('position', upPosition);
            
            // Hide mole after 1.2 seconds
            setTimeout(() => {
                hideMole(mole);
            }, 1200);
        }

        // Function to hide a mole
        function hideMole(mole) {
            if (!activeMoles.has(mole)) return;
            
            // Get current position and move back down
            const currentPos = mole.getAttribute('position');
            const downPosition = `${currentPos.x} -1 ${currentPos.z}`;
            
            // Move mole down
            mole.setAttribute('position', downPosition);
            
            // Remove from active set
            activeMoles.delete(mole);
        }

        // Function to show random moles
        function showRandomMoles() {
            if (!gameActive) return;
            
            const inactiveMoles = Array.from(moles).filter(mole => !activeMoles.has(mole));
            if (inactiveMoles.length === 0) return;
            
            // Randomly decide how many moles to show (1-2 moles)
            const numberOfMoles = Math.random() > 0.6 ? 2 : 1;
            
            // Shuffle the inactive moles and take the first few
            const shuffled = inactiveMoles.sort(() => 0.5 - Math.random());
            const molesToShow = shuffled.slice(0, Math.min(numberOfMoles, inactiveMoles.length));
            
            molesToShow.forEach(mole => {
                showMole(mole);
            });
        }

        // Function to start countdown
        function startCountdown() {
            let count = 3;
            countdown.setAttribute('visible', true);
            
            const countdownInterval = setInterval(() => {
                countdown.setAttribute('value', count.toString());
                count--;
                
                if (count < 0) {
                    clearInterval(countdownInterval);
                    countdown.setAttribute('visible', false);
                    startGame();
                }
            }, 1000);
        }

        // Function to hide instructions and show game UI
        function hideInstructions() {
            instructionsScreen.setAttribute('visible', false);
            scoreDisplay.setAttribute('visible', true);
        }

        // Start button click handler
        startButton.addEventListener('click', function() {
            console.log('Green ball clicked!');
            if (gameStarted) return;
            
            gameStarted = true;
            hideInstructions();
            startCountdown();
        });

        // Add click listeners to moles
        moles.forEach(mole => {
            mole.addEventListener('click', function() {
                if (!activeMoles.has(this)) return;
                
                console.log(`Mole ${this.id} was clicked!`);
                score += 10;
                scoreDisplay.setAttribute('value', `Score: ${score}`);
                
                // Flash effect when hit - works for both material and color attributes
                const material = this.getAttribute('material');
                const originalColor = material.color;
                
                this.setAttribute('material', 'color', 'red');
                
                setTimeout(() => {
                    this.setAttribute('material', 'color', originalColor);
                }, 200);
                
                // Hide the mole immediately when hit
                hideMole(this);
            });
        });

        // Start the game
        function startGame() {
            console.log('Game started!');
            gameActive = true;
            
            const gameInterval = setInterval(() => {
                if (!gameActive) {
                    clearInterval(gameInterval);
                    return;
                }
                showRandomMoles();
            }, 800);
        }

        // Scene loaded event
        document.querySelector('a-scene').addEventListener('loaded', () => {
            console.log('Scene loaded, showing instructions...');
        });
    </script>
</body>
</html>
